clone_depth: 1
configuration: Release
image: Visual Studio 2022
platform: x64
skip_tags: true

environment:
  MSSQL_HOST: (local)\\SQL2019
  OSGEO4W_ROOT: C:\OSGeo4W
  PGPASSWORD: Password12!

install:
  - call "C:\Program Files\Microsoft Visual Studio\2022\Community\VC\Auxiliary\Build\vcvars64.bat"
  - mkdir %OSGEO4W_ROOT%
  - ps: Invoke-WebRequest -Uri http://download.osgeo.org/osgeo4w/setup.exe -OutFile $env:OSGEO4W_ROOT\setup.exe
  - call %OSGEO4W_ROOT%\setup.exe -q -k -r -A -s http://download.osgeo.org/osgeo4w/v2 -P curl-devel,libmysql-devel,libpq-devel,libspatialite-devel,sqlite3-devel -R %OSGEO4W_ROOT% > nul
  - SET INCLUDE=%APPVEYOR_BUILD_FOLDER%\include;C:\Libraries\boost_1_89_0;%OSGEO4W_ROOT%\include;%INCLUDE%
  - SET LIB=%OSGEO4W_ROOT%\lib;%LIB%
  - SET PATH=%OSGEO4W_ROOT%\bin;%PATH%
  - net start MSSQL$SQL2019
  - ps: Start-Service MySQL80
  - curl -L -O -S -s http://download.osgeo.org/postgis/windows/pg16/postgis-bundle-pg16-3.5.3x64.zip
  - call "C:\Program Files\7-Zip\7z.exe" x postgis-bundle-pg16-3.5.3x64.zip > nul
  - xcopy /s /y /q postgis-bundle-pg16-3.5.3x64 "C:\Program Files\PostgreSQL\16"
  - net start postgresql-x64-16
  - call "C:\Program Files\PostgreSQL\16\bin\psql" -U postgres -c "CREATE EXTENSION postgis;"

build_script:
  - echo example

test_script:
  - cd %APPVEYOR_BUILD_FOLDER%\test
  - SET CXXFLAGS=/DBOAT_TEST_PASSWORD=%PGPASSWORD% /DBOAT_TEST_MSSQL_HOST=%MSSQL_HOST% /DBOAT_TEST_MYSQL_HOST=localhost /DBOAT_TEST_POSTGRESQL_HOST=localhost&& nmake -f .\windows.makefile test
